<!DOCTYPE html>
<html>
<body>
	<img src="img/test1.png" id="image">
	<canvas id="imgCanvas" width="100" height="500" style="border:1px solid #d3d3d3;"></canvas>

	<style>
		img {
			display: none;
		}
	</style>
	<script>
	var ctx = document.getElementById("imgCanvas").getContext("2d");
	var img = document.getElementById("image");

	rValue=[]
	dataSet=[]
	function copy() {
		//default canvas setting
		document.getElementById("imgCanvas").width=img.width+50
		document.getElementById("imgCanvas").height=img.height*2+150
		ctx.drawImage(img, 10, 10);

		//get border coordinates
		var imgData = ctx.getImageData(10, 10, img.width, img.height);
		for (i=0; i<imgData.data.length/4; i++) {
			rValue[i]=imgData.data[4*i]
		}
		for (j=0; j<img.height; j++) {
			for (i=0; i<img.width; i++) {
				if (rValue[i+img.width*j]>250 && rValue[i+img.width*j-1]<250) {
					dataSet[dataSet.length]=[i-1,j,1]
				} 
				if (rValue[i+img.width*j]>250 && rValue[i+img.width*j+1]<250) {
					dataSet[dataSet.length]=[i+1,j,2]
				} 
				if (rValue[i+img.width*j]>250 && rValue[i+img.width*(j-1)]<250) {
					dataSet[dataSet.length]=[i,j-1,3]
				} 
				if (rValue[i+img.width*j]>250 && rValue[i+img.width*(j+1)]<250) {
					dataSet[dataSet.length]=[i,j+1,4]
				}
			} 
		}		
		//draw border coordinates
		document.getElementById("test").innerHTML=dataSet.length;
		for (i=0; i<dataSet.length; i++) {
			ctx.fillRect(dataSet[i][0]+10,dataSet[i][1]+img.height+100,1,1)
		}
	}

	velocityX=[]
	velocityY=[]
	coordX=[]
	coordY=[]
	velocityX[0]=Math.random()/5
	velocityY[0]=Math.random()/5
	coordX[0]=img.width/2
	coordY[0]=img.height/2
	radius=10
	function start() {
		ctx.clearRect(10,img.height+100,img.width,img.height)
		for (i=0; i<dataSet.length; i++) {
			ctx.fillRect(dataSet[i][0]+10,dataSet[i][1]+img.height+100,1,1)
		}
		for (i=0; i<dataSet.length; i++) {
			if (Math.pow(coordX[0]-dataSet[i][0],2)+Math.pow(coordY[0]-dataSet[i][1],2)>Math.pow(radius,2)) {
			} else {
				//search if any duplicates come out and then decide
				counter=[dataSet[i][2]]
				for (j=i+1; j<dataSet.length; j++) {
					if (dataSet[i][0]==dataSet[j][0] && dataSet[i][1]==dataSet[j][1]) {
						counter[counter.length]=dataSet[j][2]
					}
				}
				//decision
				for (j=0; j<counter.length; j++) {
					if (counter[j]==1) {
						velocityX[0]=velocityX[0]*(-0.9-Math.random()/5)
					}
					if (counter[j]==2) {
						velocityX[0]=velocityX[0]*(-0.9-Math.random()/5)
					}
					if (counter[j]==3) {
						velocityY[0]=velocityY[0]*(-0.9-Math.random()/5)
					}
					if (counter[j]==4) {
						velocityY[0]=velocityY[0]*(-0.9-Math.random()/5)
					}
				}
				break	
			}
		} 
		coordX[0]+=velocityX[0]
		coordY[0]+=velocityY[0]
		ctx.beginPath()
		ctx.arc(coordX[0]+10,coordY[0]+img.height+100,10,0,Math.PI*2)
		ctx.stroke()
		document.getElementById("test").value=velocityX[0];
		document.getElementById("test").innerHTML=velocityY[0];
		window.setTimeout(start,4)
	}


	</script>

	<button onclick="copy()">Copy</button>
	<button onclick="start()">Start</button>
	<span id="test">
	<span id="tester">
	<span id="test12">

</body>
</html>
